import{E as J,o as h,c as T,b as e,w as l,y,r as d,D as v,h as n,q as p,f as k,X as K,$ as L,G as Q,j as B,M as x,a as V,N as W,O as Y}from"./index-BQs85f6M.js";import{u as Z}from"./scores-BXLXBFBG.js";import{_ as ee}from"./_plugin-vue_export-helper-DlAUqK2U.js";const le={class:"appeal-handling"},ae={class:"card-header"},te={class:"header-stats"},oe={key:0},ne={__name:"AppealHandling",setup(se){const _=Z(),S=v("pending"),f=v(!1),u=v("approve"),r=v(null),w=v(null),c=v({result:""}),F={result:[{required:!0,message:"请输入处理意见",trigger:"blur"}]},H=y(()=>_.appeals),b=y(()=>_.pendingAppeals),C=y(()=>H.value.filter(o=>o.status!=="pending"));function R(o){r.value=o,u.value="approve",c.value.result=`经复核，同意将「${o.indicatorName}」得分从${o.originalScore}分调整为${o.expectedScore}分`,f.value=!0}function j(o){r.value=o,u.value="reject",c.value.result="",f.value=!0}function D(){var o;r.value=null,c.value.result="",(o=w.value)==null||o.clearValidate()}function E(){var o;(o=w.value)==null||o.validate(t=>{if(t){const i=u.value==="approve"?"approved":"rejected";_.handleAppeal(r.value.id,"管理员",c.value.result,i),f.value=!1,Y.success(i==="approved"?"申诉通过":"申诉驳回")}})}function M(o){W.alert(o.reason,"申诉详情",{confirmButtonText:"知道了"})}return J(()=>{console.log("=== AppealHandling Debug ==="),console.log("Appeals count:",_.appeals.length),console.log("Pending appeals:",b.value.length),_.appeals.length===0&&localStorage.getItem("scoreAppeals")&&(console.log("Found data in localStorage but store is empty, reloading..."),_.resetScores())}),(o,t)=>{const i=d("el-tag"),s=d("el-table-column"),g=d("el-button"),N=d("el-table"),z=d("el-empty"),A=d("el-tab-pane"),U=d("el-tabs"),q=d("el-card"),m=d("el-descriptions-item"),I=d("el-descriptions"),G=d("el-input"),O=d("el-form-item"),P=d("el-form"),X=d("el-dialog");return h(),T("div",le,[e(q,{class:"page-card",shadow:"hover"},{header:l(()=>[V("div",ae,[t[4]||(t[4]=V("span",{class:"card-title"},"申诉处理",-1)),V("div",te,[e(i,{type:"warning",size:"large"},{default:l(()=>[n(" 待处理: "+p(b.value.length)+" 项 ",1)]),_:1})])])]),default:l(()=>[e(U,{modelValue:S.value,"onUpdate:modelValue":t[0]||(t[0]=a=>S.value=a),class:"appeal-tabs"},{default:l(()=>[e(A,{label:"待处理申诉",name:"pending"},{default:l(()=>[e(N,{data:b.value,style:{width:"100%"}},{default:l(()=>[e(s,{prop:"teacherName",label:"教师姓名",width:"120"}),e(s,{prop:"department",label:"部门",width:"150"}),e(s,{prop:"indicatorName",label:"指标名称",width:"150"}),e(s,{label:"原始得分",width:"100",align:"center"},{default:l(({row:a})=>[e(i,{type:"info",size:"small"},{default:l(()=>[n(p(a.originalScore),1)]),_:2},1024)]),_:1}),e(s,{label:"期望得分",width:"100",align:"center"},{default:l(({row:a})=>[e(i,{type:"warning",size:"small"},{default:l(()=>[n(p(a.expectedScore),1)]),_:2},1024)]),_:1}),e(s,{prop:"reason",label:"申诉原因","min-width":"200","show-overflow-tooltip":""}),e(s,{prop:"submitTime",label:"提交时间",width:"160"}),e(s,{label:"操作",width:"200",fixed:"right"},{default:l(({row:a})=>[e(g,{type:"success",size:"small",icon:k(K),onClick:$=>R(a)},{default:l(()=>[...t[5]||(t[5]=[n(" 通过 ",-1)])]),_:1},8,["icon","onClick"]),e(g,{type:"danger",size:"small",icon:k(L),onClick:$=>j(a)},{default:l(()=>[...t[6]||(t[6]=[n(" 驳回 ",-1)])]),_:1},8,["icon","onClick"]),e(g,{type:"primary",size:"small",link:"",icon:k(Q),onClick:$=>M(a)},{default:l(()=>[...t[7]||(t[7]=[n(" 查看详情 ",-1)])]),_:1},8,["icon","onClick"])]),_:1})]),_:1},8,["data"]),b.value.length===0?(h(),B(z,{key:0,description:"暂无待处理申诉","image-size":120})):x("",!0)]),_:1}),e(A,{label:"已处理申诉",name:"processed"},{default:l(()=>[e(N,{data:C.value,style:{width:"100%"}},{default:l(()=>[e(s,{prop:"teacherName",label:"教师姓名",width:"120"}),e(s,{prop:"department",label:"部门",width:"150"}),e(s,{prop:"indicatorName",label:"指标名称",width:"150"}),e(s,{label:"原始得分",width:"100",align:"center"},{default:l(({row:a})=>[e(i,{type:"info",size:"small"},{default:l(()=>[n(p(a.originalScore),1)]),_:2},1024)]),_:1}),e(s,{label:"期望得分",width:"100",align:"center"},{default:l(({row:a})=>[e(i,{type:"warning",size:"small"},{default:l(()=>[n(p(a.expectedScore),1)]),_:2},1024)]),_:1}),e(s,{label:"处理结果",width:"100"},{default:l(({row:a})=>[e(i,{type:a.status==="approved"?"success":"danger",size:"small"},{default:l(()=>[n(p(a.status==="approved"?"已通过":"已驳回"),1)]),_:2},1032,["type"])]),_:1}),e(s,{prop:"handleResult",label:"处理意见","min-width":"200","show-overflow-tooltip":""}),e(s,{prop:"handler",label:"处理人",width:"100"}),e(s,{prop:"handleTime",label:"处理时间",width:"160"})]),_:1},8,["data"]),C.value.length===0?(h(),B(z,{key:0,description:"暂无已处理申诉","image-size":120})):x("",!0)]),_:1})]),_:1},8,["modelValue"])]),_:1}),e(X,{modelValue:f.value,"onUpdate:modelValue":t[3]||(t[3]=a=>f.value=a),title:u.value==="approve"?"通过申诉":"驳回申诉",width:"600px",onClose:D},{footer:l(()=>[e(g,{onClick:t[2]||(t[2]=a=>f.value=!1)},{default:l(()=>[...t[8]||(t[8]=[n("取消",-1)])]),_:1}),e(g,{type:u.value==="approve"?"success":"danger",onClick:E},{default:l(()=>[n(" 确认"+p(u.value==="approve"?"通过":"驳回"),1)]),_:1},8,["type"])]),default:l(()=>[r.value?(h(),T("div",oe,[e(I,{column:2,border:"",class:"appeal-info"},{default:l(()=>[e(m,{label:"教师姓名"},{default:l(()=>[n(p(r.value.teacherName),1)]),_:1}),e(m,{label:"部门"},{default:l(()=>[n(p(r.value.department),1)]),_:1}),e(m,{label:"指标名称",span:2},{default:l(()=>[n(p(r.value.indicatorName),1)]),_:1}),e(m,{label:"原始得分"},{default:l(()=>[n(p(r.value.originalScore),1)]),_:1}),e(m,{label:"期望得分"},{default:l(()=>[n(p(r.value.expectedScore),1)]),_:1}),e(m,{label:"申诉原因",span:2},{default:l(()=>[n(p(r.value.reason),1)]),_:1}),e(m,{label:"提交时间",span:2},{default:l(()=>[n(p(r.value.submitTime),1)]),_:1})]),_:1}),e(P,{model:c.value,rules:F,ref_key:"handleFormRef",ref:w,"label-width":"100px"},{default:l(()=>[e(O,{label:"处理意见",prop:"result"},{default:l(()=>[e(G,{modelValue:c.value.result,"onUpdate:modelValue":t[1]||(t[1]=a=>c.value.result=a),type:"textarea",rows:4,placeholder:u.value==="approve"?"请说明通过理由":"请说明驳回理由",maxlength:"200","show-word-limit":""},null,8,["modelValue","placeholder"])]),_:1})]),_:1},8,["model"])])):x("",!0)]),_:1},8,["modelValue","title"])])}}},ie=ee(ne,[["__scopeId","data-v-99cb7569"]]);export{ie as default};
