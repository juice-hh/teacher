import{E as X,o as p,c as x,b as e,w as l,y as b,D as C,r,a as h,F as Y,p as Z,j as M,h as c,q as f,f as B,G as ee,_ as U,M as E,N as I,O as N}from"./index-BQs85f6M.js";import{u as te}from"./scores-BXLXBFBG.js";import{_ as le}from"./_plugin-vue_export-helper-DlAUqK2U.js";const ae={class:"score-detail"},oe={class:"card-header"},ne={class:"header-actions"},re={class:"filter-bar"},se={key:0},ce={__name:"ScoreDetail",setup(ie){const u=te(),n=C({semester:"",department:"",confirmed:""}),y=C(!1),i=C(null),P=b(()=>u.scores),_=b(()=>u.semesters),D=b(()=>{let a=P.value;if(n.value.semester&&(a=a.filter(t=>t.semester===n.value.semester)),n.value.department&&(a=a.filter(t=>t.department===n.value.department)),n.value.confirmed!==""){const t=n.value.confirmed==="true";a=a.filter(d=>d.confirmed===t)}return a}),j=b(()=>D.value.some(a=>!a.confirmed));function S(){}function w(a){return a>=90?"success":a>=80?"primary":a>=60?"warning":"danger"}function T(a,t){return a?Math.round(a/t*100):0}function q(a,t){const d=T(a,t);return d>=80?"#67c23a":d>=60?"#e6a23c":"#f56c6c"}function A(a){I.confirm(`确认「${a.teacherName}」的积分吗？`,"确认积分",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then(()=>{u.confirmScore(a.id,"管理员"),N.success("积分确认成功")}).catch(()=>{})}function G(){const a=n.value.semester;if(!a){N.warning("请先选择学期");return}I.confirm(`确认本学期「${a}」的全部积分吗？`,"批量确认",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then(()=>{const t=u.batchConfirmScores(a,"管理员");N.success(`已确认 ${t} 位教师的积分`)}).catch(()=>{})}function L(a){i.value=a,y.value=!0}return X(()=>{console.log("=== ScoreDetail Debug ==="),console.log("Scores count:",u.scores.length),console.log("Semesters:",_.value),u.scores.length===0&&localStorage.getItem("evaluationScores")&&(console.log("Found data in localStorage but store is empty, reloading..."),u.resetScores()),_.value.length>0&&(n.value.semester=_.value[0])}),(a,t)=>{var z,F;const d=r("el-button"),m=r("el-option"),V=r("el-select"),k=r("el-form-item"),O=r("el-form"),s=r("el-table-column"),v=r("el-tag"),$=r("el-table"),H=r("el-card"),g=r("el-descriptions-item"),J=r("el-descriptions"),K=r("el-divider"),Q=r("el-progress"),R=r("el-dialog");return p(),x("div",ae,[e(H,{class:"page-card",shadow:"hover"},{header:l(()=>[h("div",oe,[t[5]||(t[5]=h("span",{class:"card-title"},"教师积分明细",-1)),h("div",ne,[e(d,{type:"primary",icon:B(U),onClick:G,disabled:!j.value},{default:l(()=>[...t[4]||(t[4]=[c(" 批量确认本学期全部积分 ",-1)])]),_:1},8,["icon","disabled"])])])]),default:l(()=>[h("div",re,[e(O,{inline:!0},{default:l(()=>[e(k,{label:"学期"},{default:l(()=>[e(V,{modelValue:n.value.semester,"onUpdate:modelValue":t[0]||(t[0]=o=>n.value.semester=o),placeholder:"请选择学期",clearable:"",onChange:S},{default:l(()=>[(p(!0),x(Y,null,Z(_.value,o=>(p(),M(m,{key:o,label:o,value:o},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])]),_:1}),e(k,{label:"部门"},{default:l(()=>[e(V,{modelValue:n.value.department,"onUpdate:modelValue":t[1]||(t[1]=o=>n.value.department=o),placeholder:"请选择部门",clearable:"",onChange:S},{default:l(()=>[e(m,{label:"计算机学院",value:"计算机学院"}),e(m,{label:"数学学院",value:"数学学院"}),e(m,{label:"英语学院",value:"英语学院"}),e(m,{label:"物理学院",value:"物理学院"})]),_:1},8,["modelValue"])]),_:1}),e(k,{label:"确认状态"},{default:l(()=>[e(V,{modelValue:n.value.confirmed,"onUpdate:modelValue":t[2]||(t[2]=o=>n.value.confirmed=o),placeholder:"请选择状态",clearable:"",onChange:S},{default:l(()=>[e(m,{label:"已确认",value:"true"}),e(m,{label:"待确认",value:"false"})]),_:1},8,["modelValue"])]),_:1})]),_:1})]),e($,{data:D.value,style:{width:"100%"},border:""},{default:l(()=>[e(s,{prop:"teacherName",label:"教师姓名",width:"120"}),e(s,{prop:"department",label:"部门",width:"150"}),e(s,{prop:"semester",label:"学期",width:"150"}),e(s,{prop:"totalScore",label:"总分",width:"100",align:"center"},{default:l(({row:o})=>[e(v,{type:w(o.totalScore),size:"large"},{default:l(()=>[c(f(o.totalScore),1)]),_:2},1032,["type"])]),_:1}),e(s,{label:"确认状态",width:"120",align:"center"},{default:l(({row:o})=>[e(v,{type:o.confirmed?"success":"warning",size:"small"},{default:l(()=>[c(f(o.confirmed?"已确认":"待确认"),1)]),_:2},1032,["type"])]),_:1}),e(s,{prop:"confirmedBy",label:"确认人",width:"100"}),e(s,{prop:"confirmedAt",label:"确认时间",width:"160"}),e(s,{label:"操作",width:"200",fixed:"right"},{default:l(({row:o})=>[e(d,{type:"primary",size:"small",link:"",icon:B(ee),onClick:W=>L(o)},{default:l(()=>[...t[6]||(t[6]=[c(" 查看明细 ",-1)])]),_:1},8,["icon","onClick"]),o.confirmed?E("",!0):(p(),M(d,{key:0,type:"success",size:"small",link:"",icon:B(U),onClick:W=>A(o)},{default:l(()=>[...t[7]||(t[7]=[c(" 确认 ",-1)])]),_:1},8,["icon","onClick"]))]),_:1})]),_:1},8,["data"])]),_:1}),e(R,{modelValue:y.value,"onUpdate:modelValue":t[3]||(t[3]=o=>y.value=o),title:`${(z=i.value)==null?void 0:z.teacherName} - ${(F=i.value)==null?void 0:F.semester} 积分明细`,width:"800px"},{default:l(()=>[i.value?(p(),x("div",se,[e(J,{column:2,border:"",class:"teacher-info"},{default:l(()=>[e(g,{label:"教师姓名"},{default:l(()=>[c(f(i.value.teacherName),1)]),_:1}),e(g,{label:"部门"},{default:l(()=>[c(f(i.value.department),1)]),_:1}),e(g,{label:"学期"},{default:l(()=>[c(f(i.value.semester),1)]),_:1}),e(g,{label:"总分"},{default:l(()=>[e(v,{type:w(i.value.totalScore),size:"large"},{default:l(()=>[c(f(i.value.totalScore)+" 分 ",1)]),_:1},8,["type"])]),_:1})]),_:1}),e(K,{"content-position":"left"},{default:l(()=>[...t[8]||(t[8]=[c("各指标得分明细",-1)])]),_:1}),e($,{data:i.value.details,style:{width:"100%"},border:""},{default:l(()=>[e(s,{prop:"taskName",label:"任务名称",width:"180"}),e(s,{prop:"indicatorName",label:"指标名称",width:"150"}),e(s,{prop:"score",label:"得分",width:"100",align:"center"},{default:l(({row:o})=>[e(v,{type:w(o.score),size:"small"},{default:l(()=>[c(f(o.score),1)]),_:2},1032,["type"])]),_:1}),e(s,{prop:"maxScore",label:"满分",width:"100",align:"center"}),e(s,{label:"得分率",width:"120",align:"center"},{default:l(({row:o})=>[e(Q,{percentage:T(o.score,o.maxScore),color:q(o.score,o.maxScore),"stroke-width":8},null,8,["percentage","color"])]),_:1})]),_:1},8,["data"])])):E("",!0)]),_:1},8,["modelValue","title"])])}}},fe=le(ce,[["__scopeId","data-v-0980305f"]]);export{fe as default};
