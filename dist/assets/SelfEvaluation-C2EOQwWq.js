import{E as P,o as p,c as f,b as l,w as i,D as S,r,a as s,F as V,p as B,f as x,h as u,q as a,a3 as j,y as q,O as w,N as L}from"./index-BQs85f6M.js";import{u as R}from"./indicator-ax52G24x.js";import{_ as W}from"./_plugin-vue_export-helper-DlAUqK2U.js";const $={class:"self-evaluation"},A={class:"card-header"},G={class:"header-actions"},H={class:"evaluation-content"},K={class:"indicator-sections"},Q={class:"section-header"},X={class:"section-title"},Y={class:"section-desc"},Z={class:"secondary-items"},ss={class:"item-header"},ts={class:"item-name"},es={class:"item-info"},as={class:"info-row"},os={class:"info-value"},ls={class:"info-row"},ns={class:"info-value"},is={class:"info-row"},ds={class:"info-value"},rs={class:"item-score"},us={class:"score-tip"},cs={class:"item-material"},ms={class:"item-remark"},_s={class:"score-summary"},vs={class:"summary-card"},ps={class:"summary-content"},fs={class:"summary-item"},hs={class:"summary-value"},bs={class:"summary-item"},gs={class:"summary-value"},ys={class:"summary-item"},Ss={class:"summary-value"},xs={class:"summary-item"},ws={class:"summary-value"},Is={class:"summary-item"},ks={class:"summary-value"},Ds={class:"summary-total"},Vs={class:"total-value"},Bs={__name:"SelfEvaluation",setup(Ns){const b=R(),{primaryIndicators:N,getSecondaryByPrimary:I}=b,d=S({}),c=S({}),h=S({});P(()=>{b.loadFromLocal(),F()});const g=q(()=>{let e=0;return Object.values(d.value).forEach(t=>{e+=Number(t)||0}),e.toFixed(1)});function m(e){const t=I(e);let n=0;return t.forEach(y=>{n+=Number(d.value[y.id])||0}),n.toFixed(1)}function E(e,t){h.value[e]||(h.value[e]=[]),h.value[e].push(t)}function O(){const e={evaluationData:d.value,remarks:c.value,timestamp:new Date().toISOString()};localStorage.setItem("evaluation_draft",JSON.stringify(e)),w.success("草稿已保存")}function F(){const e=localStorage.getItem("evaluation_draft");if(e){const t=JSON.parse(e);d.value=t.evaluationData||{},c.value=t.remarks||{}}}function U(){const e=b.secondaryIndicators;if(Object.keys(d.value).filter(n=>d.value[n]!==void 0&&d.value[n]!=="").length<e.length){w.warning("请完成所有项目的评分后再提交");return}L.confirm(`您的自评总分为 ${g.value} 分，确定要提交吗？提交后将无法修改。`,"确认提交",{confirmButtonText:"确定提交",cancelButtonText:"再检查一下",type:"warning"}).then(()=>{const n={evaluationData:d.value,remarks:c.value,totalScore:g.value,submitTime:new Date().toISOString()};localStorage.setItem("evaluation_submission",JSON.stringify(n)),localStorage.removeItem("evaluation_draft"),w.success("评价提交成功！")})}return(e,t)=>{const n=r("el-button"),y=r("el-alert"),k=r("el-tag"),C=r("el-input-number"),D=r("el-form-item"),T=r("el-upload"),z=r("el-input"),J=r("el-divider"),M=r("el-card");return p(),f("div",$,[l(M,{class:"page-card",shadow:"hover"},{header:i(()=>[s("div",A,[t[2]||(t[2]=s("span",{class:"card-title"},"自我评价",-1)),s("div",G,[l(n,{onClick:O},{default:i(()=>[...t[0]||(t[0]=[u("保存草稿",-1)])]),_:1}),l(n,{type:"primary",onClick:U},{default:i(()=>[...t[1]||(t[1]=[u("提交评价",-1)])]),_:1})])])]),default:i(()=>[s("div",H,[l(y,{title:"请根据各项指标要求，如实填写自我评价，并上传相关证明材料",type:"info",closable:!1,"show-icon":"",style:{"margin-bottom":"24px"}}),s("div",K,[(p(!0),f(V,null,B(x(N),_=>(p(),f("div",{class:"indicator-section",key:_.id},[s("div",Q,[s("h3",X,[u(a(_.name)+" ",1),l(k,{type:"primary",size:"large"},{default:i(()=>[u(a(_.score)+"分",1)]),_:2},1024)]),s("p",Y,a(_.description),1)]),s("div",Z,[(p(!0),f(V,null,B(x(I)(_.id),o=>(p(),f("div",{class:"secondary-item",key:o.id},[s("div",ss,[s("span",ts,a(o.name),1),l(k,{type:"warning",size:"small"},{default:i(()=>[u(a(o.score)+"分",1)]),_:2},1024)]),s("div",es,[s("div",as,[t[3]||(t[3]=s("span",{class:"info-label"},"评分标准：",-1)),s("span",os,a(o.scoringRule),1)]),s("div",ls,[t[4]||(t[4]=s("span",{class:"info-label"},"材料要求：",-1)),s("span",ns,a(o.materialRequirement),1)]),s("div",is,[t[5]||(t[5]=s("span",{class:"info-label"},"责任部门：",-1)),s("span",ds,a(o.responsibleBody),1)])]),s("div",rs,[l(D,{label:"自评分数"},{default:i(()=>[l(C,{modelValue:d.value[o.id],"onUpdate:modelValue":v=>d.value[o.id]=v,min:0,max:o.score,precision:1},null,8,["modelValue","onUpdate:modelValue","max"]),s("span",us,"/ "+a(o.score)+"分",1)]),_:2},1024)]),s("div",cs,[l(D,{label:"上传材料"},{default:i(()=>[l(T,{action:"#","auto-upload":!1,"on-change":v=>E(o.id,v),"file-list":h.value[o.id]||[],limit:5,multiple:""},{tip:i(()=>[...t[7]||(t[7]=[s("div",{class:"upload-tip"},"支持上传图片、PDF、Word等格式，最多5个文件",-1)])]),default:i(()=>[l(n,{size:"small",icon:x(j)},{default:i(()=>[...t[6]||(t[6]=[u("上传文件",-1)])]),_:1},8,["icon"])]),_:1},8,["on-change","file-list"])]),_:2},1024)]),s("div",ms,[l(z,{modelValue:c.value[o.id],"onUpdate:modelValue":v=>c.value[o.id]=v,type:"textarea",rows:2,placeholder:"请填写自评说明（选填）"},null,8,["modelValue","onUpdate:modelValue"])])]))),128))])]))),128))]),s("div",_s,[s("div",vs,[t[14]||(t[14]=s("div",{class:"summary-title"},"评分统计",-1)),s("div",ps,[s("div",fs,[t[8]||(t[8]=s("span",{class:"summary-label"},"教学态度",-1)),s("span",hs,a(m(1))+" / 20分",1)]),s("div",bs,[t[9]||(t[9]=s("span",{class:"summary-label"},"教学方法",-1)),s("span",gs,a(m(2))+" / 25分",1)]),s("div",ys,[t[10]||(t[10]=s("span",{class:"summary-label"},"育人成效",-1)),s("span",Ss,a(m(3))+" / 25分",1)]),s("div",xs,[t[11]||(t[11]=s("span",{class:"summary-label"},"专业发展",-1)),s("span",ws,a(m(4))+" / 20分",1)]),s("div",Is,[t[12]||(t[12]=s("span",{class:"summary-label"},"社会服务",-1)),s("span",ks,a(m(5))+" / 10分",1)]),l(J),s("div",Ds,[t[13]||(t[13]=s("span",{class:"total-label"},"总分",-1)),s("span",Vs,a(g.value)+" / 100分",1)])])])])])]),_:1})])}}},Us=W(Bs,[["__scopeId","data-v-539436be"]]);export{Us as default};
