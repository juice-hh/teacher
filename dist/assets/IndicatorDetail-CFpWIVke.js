import{D as V,E as ce,P as fe,o as u,c as p,b as l,w as a,k as _e,r as s,e as ye,a as o,h as i,F as I,p as D,f as c,j as U,q as v,Q as be,H as Ve,I as ge,M as z,K as ke,x as we,L as Ie,y as J,N as xe,O as x}from"./index-BQs85f6M.js";import{u as Re}from"./indicator-ax52G24x.js";import{u as Be}from"./rules-uKwgUioL.js";import{_ as Se}from"./_plugin-vue_export-helper-DlAUqK2U.js";const Ue={class:"indicator-detail-page"},Ce={class:"card-header"},$e={class:"header-actions"},De={class:"detail-container"},Ne={class:"left-sidebar"},Ee={class:"sidebar-filter"},Me={class:"sidebar-tabs"},Te=["title"],qe={class:"right-content"},Fe={class:"section-title"},Pe={key:0,class:"title-actions"},ze={key:0,class:"info-block"},Le={class:"info-row"},je={class:"info-value font-bold"},Ae={class:"info-row"},He={class:"info-value"},Ke={class:"info-row"},Oe={class:"info-value text-gray"},Qe={class:"info-row"},Ge={class:"info-value font-bold"},Je={class:"info-row"},We={class:"info-value"},Xe={class:"info-row"},Ye={class:"info-value text-gray"},Ze={class:"info-row type-row"},he={class:"info-value"},el={key:1,class:"text-placeholder"},ll={class:"info-row"},al={class:"info-value"},ol={class:"info-row"},tl={class:"info-value"},nl={key:1,class:"empty-state"},dl={class:"rule-option-desc"},sl={class:"form-tip"},il={__name:"IndicatorDetail",setup(ul){const T=_e(),R=ye(),b=Re(),L=Be(),{primaryIndicators:C,getSecondaryByPrimary:W}=b,{ruleTypes:X,getRulesByType:Y}=L,j=V("all"),g=V(Number(T.params.id)),f=V(T.params.type),Z=J(()=>`${f.value}-${g.value}`);ce(()=>{b.loadFromLocal()});const r=J(()=>f.value==="primary"?C.find(n=>n.id===g.value):f.value==="secondary"?b.secondaryIndicators.find(n=>n.id===g.value):null);function h(n){const[e,E]=n.split("-"),M=Number(E);f.value=e,g.value=M,R.replace({params:{type:e,id:M}})}fe(()=>T.params,n=>{n.id&&n.type&&(g.value=Number(n.id),f.value=n.type)});const B=V(!1),S=V(!1),N=V(!1),$=V(!1),m=V({id:null,name:"",score:20,description:""}),d=V({id:null,primaryId:null,name:"",score:5,scoringRule:"",linkedRuleId:null,linkedRule:"",materialRequirement:"",responsibleBody:""});function ee(n){n==="primary"?(N.value=!1,m.value={id:null,name:"",score:20,description:""},B.value=!0):n==="secondary"&&($.value=!1,d.value={id:null,primaryId:g.value,name:"",score:5,scoringRule:"",linkedRuleId:null,linkedRule:"",materialRequirement:"",responsibleBody:""},S.value=!0)}function le(){f.value==="primary"?(N.value=!0,m.value={...r.value},B.value=!0):($.value=!0,d.value={...r.value},S.value=!0)}function ae(){const n=f.value==="primary",e=n?"删除该指标将同时删除其下所有二级指标，确定要删除吗？":"确定要删除该二级指标吗？";xe.confirm(e,"提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then(()=>{n?b.deletePrimaryIndicator(g.value):b.deleteSecondaryIndicator(g.value),x.success("删除成功"),C.length>0?R.replace(`/admin/indicator-detail/primary/${C[0].id}`):R.back()}).catch(()=>{})}function oe(){if(!m.value.name){x.warning("请输入指标名称");return}if(N.value)b.updatePrimaryIndicator(m.value.id,m.value),x.success("更新成功");else{const n=b.addPrimaryIndicator(m.value);x.success("添加成功"),n&&R.replace(`/admin/indicator-detail/primary/${n.id}`)}B.value=!1}function te(){if(!d.value.name){x.warning("请输入指标名称");return}if(d.value.linkedRuleId){const n=L.getRuleById(d.value.linkedRuleId);n&&(d.value.linkedRule=n.name)}else d.value.linkedRule="";if($.value)b.updateSecondaryIndicator(d.value.id,d.value),x.success("更新成功");else{const n=b.addSecondaryIndicator(d.value);x.success("添加成功"),n&&R.replace(`/admin/indicator-detail/secondary/${n.id}`)}S.value=!1}return(n,e)=>{const E=s("el-breadcrumb-item"),M=s("el-breadcrumb"),q=s("el-icon"),k=s("el-button"),A=s("el-dropdown-item"),ne=s("el-dropdown-menu"),de=s("el-dropdown"),w=s("el-input"),F=s("el-radio-button"),se=s("el-radio-group"),ie=s("el-menu-item"),ue=s("el-sub-menu"),re=s("el-menu"),P=s("el-tag"),me=s("el-empty"),ve=s("el-card"),_=s("el-form-item"),H=s("el-input-number"),K=s("el-form"),O=s("el-dialog"),Q=s("el-option"),G=s("el-select"),pe=s("el-option-group");return u(),p("div",Ue,[l(ve,{class:"page-card",shadow:"hover"},{header:a(()=>[o("div",Ce,[l(M,{separator:"/"},{default:a(()=>[l(E,{to:{path:"/admin/indicator-management"}},{default:a(()=>[...e[16]||(e[16]=[i("评价指标管理",-1)])]),_:1}),l(E,null,{default:a(()=>[...e[17]||(e[17]=[i("指标详情",-1)])]),_:1})]),_:1}),o("div",$e,[l(de,{class:"mr-2",onCommand:ee},{dropdown:a(()=>[l(ne,null,{default:a(()=>[l(A,{command:"primary"},{default:a(()=>[...e[19]||(e[19]=[i("新增一级指标",-1)])]),_:1}),l(A,{command:"secondary",disabled:f.value!=="primary"},{default:a(()=>[...e[20]||(e[20]=[i("在当前项下新增二级指标",-1)])]),_:1},8,["disabled"])]),_:1})]),default:a(()=>[l(k,{type:"primary",icon:c(ke)},{default:a(()=>[e[18]||(e[18]=i(" 新增指标",-1)),l(q,{class:"el-icon--right"},{default:a(()=>[l(c(we))]),_:1})]),_:1},8,["icon"])]),_:1}),l(k,{onClick:e[0]||(e[0]=t=>c(R).back())},{default:a(()=>[...e[21]||(e[21]=[i("返回",-1)])]),_:1})])])]),default:a(()=>[o("div",De,[o("div",Ne,[o("div",Ee,[l(w,{placeholder:"请输入标题","prefix-icon":"Search"})]),o("div",Me,[l(se,{modelValue:j.value,"onUpdate:modelValue":e[1]||(e[1]=t=>j.value=t),size:"small"},{default:a(()=>[l(F,{label:"all"},{default:a(()=>[...e[22]||(e[22]=[i("全部",-1)])]),_:1}),l(F,{label:"active"},{default:a(()=>[...e[23]||(e[23]=[i("启用中",-1)])]),_:1}),l(F,{label:"inactive"},{default:a(()=>[...e[24]||(e[24]=[i("已停用",-1)])]),_:1})]),_:1},8,["modelValue"])]),l(re,{"default-active":Z.value,class:"indicator-menu",onSelect:h},{default:a(()=>[(u(!0),p(I,null,D(c(C),t=>(u(),U(ue,{key:t.id,index:`primary-${t.id}`},{title:a(()=>[l(q,null,{default:a(()=>[l(c(be))]),_:1}),o("span",null,v(t.name),1)]),default:a(()=>[(u(!0),p(I,null,D(c(W)(t.id),y=>(u(),U(ie,{key:y.id,index:`secondary-${y.id}`},{default:a(()=>[o("span",{class:"text-truncate",title:y.name},v(y.name),9,Te)]),_:2},1032,["index"]))),128))]),_:2},1032,["index"]))),128))]),_:1},8,["default-active"])]),o("div",qe,[o("div",Fe,[e[27]||(e[27]=o("div",{class:"title-left"},[o("span",{class:"title-bar"}),i(" 基本信息 ")],-1)),r.value?(u(),p("div",Pe,[l(k,{type:"primary",size:"small",icon:c(Ve),onClick:le},{default:a(()=>[...e[25]||(e[25]=[i("编辑",-1)])]),_:1},8,["icon"]),l(k,{type:"danger",size:"small",icon:c(ge),onClick:ae},{default:a(()=>[...e[26]||(e[26]=[i("删除",-1)])]),_:1},8,["icon"])])):z("",!0)]),r.value?(u(),p("div",ze,[f.value==="primary"?(u(),p(I,{key:0},[o("div",Le,[e[28]||(e[28]=o("div",{class:"info-label"},"一级指标名称：",-1)),o("div",je,v(r.value.name),1)]),o("div",Ae,[e[29]||(e[29]=o("div",{class:"info-label"},"分值：",-1)),o("div",He,[l(P,{type:"primary"},{default:a(()=>[i(v(r.value.score)+"分",1)]),_:1})])]),o("div",Ke,[e[30]||(e[30]=o("div",{class:"info-label"},"指标描述：",-1)),o("div",Oe,v(r.value.description||"暂无描述"),1)])],64)):z("",!0),f.value==="secondary"?(u(),p(I,{key:1},[o("div",Qe,[e[31]||(e[31]=o("div",{class:"info-label"},"二级指标名称：",-1)),o("div",Ge,v(r.value.name),1)]),o("div",Je,[e[32]||(e[32]=o("div",{class:"info-label"},"分值：",-1)),o("div",We,[l(P,{type:"warning"},{default:a(()=>[i(v(r.value.score)+"分",1)]),_:1})])]),o("div",Xe,[e[33]||(e[33]=o("div",{class:"info-label"},"评分标准：",-1)),o("div",Ye,v(r.value.scoringRule||"暂无填写"),1)]),o("div",Ze,[e[34]||(e[34]=o("div",{class:"info-label"},"关联评价规则：",-1)),o("div",he,[r.value.linkedRule?(u(),U(P,{key:0,type:"info"},{default:a(()=>[i(v(r.value.linkedRule),1)]),_:1})):(u(),p("span",el,"未关联"))])]),o("div",ll,[e[35]||(e[35]=o("div",{class:"info-label"},"材料要求：",-1)),o("div",al,v(r.value.materialRequirement||"暂无填写"),1)]),o("div",ol,[e[36]||(e[36]=o("div",{class:"info-label"},"责任部门：",-1)),o("div",tl,v(r.value.responsibleBody||"暂无填写"),1)])],64)):z("",!0)])):(u(),p("div",nl,[l(me,{description:"请选择左侧指标"})]))])])]),_:1}),l(O,{modelValue:B.value,"onUpdate:modelValue":e[6]||(e[6]=t=>B.value=t),title:N.value?"编辑一级指标":"新增一级指标",width:"500px"},{footer:a(()=>[l(k,{onClick:e[5]||(e[5]=t=>B.value=!1)},{default:a(()=>[...e[37]||(e[37]=[i("取消",-1)])]),_:1}),l(k,{type:"primary",onClick:oe},{default:a(()=>[...e[38]||(e[38]=[i("确定",-1)])]),_:1})]),default:a(()=>[l(K,{model:m.value,"label-width":"100px"},{default:a(()=>[l(_,{label:"指标名称"},{default:a(()=>[l(w,{modelValue:m.value.name,"onUpdate:modelValue":e[2]||(e[2]=t=>m.value.name=t),placeholder:"请输入指标名称"},null,8,["modelValue"])]),_:1}),l(_,{label:"分值"},{default:a(()=>[l(H,{modelValue:m.value.score,"onUpdate:modelValue":e[3]||(e[3]=t=>m.value.score=t),min:1,max:100},null,8,["modelValue"])]),_:1}),l(_,{label:"描述"},{default:a(()=>[l(w,{modelValue:m.value.description,"onUpdate:modelValue":e[4]||(e[4]=t=>m.value.description=t),type:"textarea",rows:3,placeholder:"请输入指标描述"},null,8,["modelValue"])]),_:1})]),_:1},8,["model"])]),_:1},8,["modelValue","title"]),l(O,{modelValue:S.value,"onUpdate:modelValue":e[15]||(e[15]=t=>S.value=t),title:$.value?"编辑二级指标":"新增二级指标",width:"600px"},{footer:a(()=>[l(k,{onClick:e[14]||(e[14]=t=>S.value=!1)},{default:a(()=>[...e[40]||(e[40]=[i("取消",-1)])]),_:1}),l(k,{type:"primary",onClick:te},{default:a(()=>[...e[41]||(e[41]=[i("确定",-1)])]),_:1})]),default:a(()=>[l(K,{model:d.value,"label-width":"100px"},{default:a(()=>[l(_,{label:"所属一级指标"},{default:a(()=>[l(G,{modelValue:d.value.primaryId,"onUpdate:modelValue":e[7]||(e[7]=t=>d.value.primaryId=t),placeholder:"请选择",disabled:$.value},{default:a(()=>[(u(!0),p(I,null,D(c(C),t=>(u(),U(Q,{key:t.id,label:t.name,value:t.id},null,8,["label","value"]))),128))]),_:1},8,["modelValue","disabled"])]),_:1}),l(_,{label:"指标名称"},{default:a(()=>[l(w,{modelValue:d.value.name,"onUpdate:modelValue":e[8]||(e[8]=t=>d.value.name=t),placeholder:"请输入指标名称"},null,8,["modelValue"])]),_:1}),l(_,{label:"分值"},{default:a(()=>[l(H,{modelValue:d.value.score,"onUpdate:modelValue":e[9]||(e[9]=t=>d.value.score=t),min:1,max:50},null,8,["modelValue"])]),_:1}),l(_,{label:"评分标准"},{default:a(()=>[l(w,{modelValue:d.value.scoringRule,"onUpdate:modelValue":e[10]||(e[10]=t=>d.value.scoringRule=t),type:"textarea",rows:3,placeholder:"请输入评分标准"},null,8,["modelValue"])]),_:1}),l(_,{label:"关联评价规则"},{default:a(()=>[l(G,{modelValue:d.value.linkedRuleId,"onUpdate:modelValue":e[11]||(e[11]=t=>d.value.linkedRuleId=t),placeholder:"请选择关联的评价规则（可选）",clearable:"",style:{width:"100%"}},{default:a(()=>[(u(!0),p(I,null,D(c(X),t=>(u(),U(pe,{key:t.value,label:t.label},{default:a(()=>[(u(!0),p(I,null,D(c(Y)(t.value),y=>(u(),U(Q,{key:y.id,label:y.name,value:y.id},{default:a(()=>[o("span",null,v(y.name),1),o("span",dl,"（"+v(y.scoringItems.length)+" 项细则）",1)]),_:2},1032,["label","value"]))),128))]),_:2},1032,["label"]))),128))]),_:1},8,["modelValue"]),o("div",sl,[l(q,null,{default:a(()=>[l(c(Ie))]),_:1}),e[39]||(e[39]=i(" 选择后，该指标将按照所选规则的评分细则进行计算 ",-1))])]),_:1}),l(_,{label:"材料要求"},{default:a(()=>[l(w,{modelValue:d.value.materialRequirement,"onUpdate:modelValue":e[12]||(e[12]=t=>d.value.materialRequirement=t),type:"textarea",rows:2,placeholder:"请输入材料要求"},null,8,["modelValue"])]),_:1}),l(_,{label:"责任部门"},{default:a(()=>[l(w,{modelValue:d.value.responsibleBody,"onUpdate:modelValue":e[13]||(e[13]=t=>d.value.responsibleBody=t),placeholder:"请输入责任部门"},null,8,["modelValue"])]),_:1})]),_:1},8,["model"])]),_:1},8,["modelValue","title"])])}}},cl=Se(il,[["__scopeId","data-v-6568d081"]]);export{cl as default};
