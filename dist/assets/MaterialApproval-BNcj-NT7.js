import{T as H,D as w,y as M,E as K,o as _,c as Q,b as e,w as a,r as u,h as n,j as h,M as N,q as c,a as x,N as L,O as B}from"./index-BQs85f6M.js";import{_ as W}from"./_plugin-vue_export-helper-DlAUqK2U.js";const X=H("materials",()=>{const p=w([]),v=[{id:1,taskId:1,taskName:"2024年度教师自评",indicatorId:1,indicatorName:"备课充分",teacherId:"T001",teacherName:"张老师",materialName:"教学教案-春季学期",materialType:"document",fileUrl:"/files/teaching-plan.pdf",description:"包含完整的教学教案、教学日历和课件",uploadTime:"2024-03-05 10:30:00",status:"pending",approveTime:null,approver:null,rejectReason:""},{id:2,taskId:1,taskName:"2024年度教师自评",indicatorId:5,indicatorName:"教学方法创新",teacherId:"T001",teacherName:"张老师",materialName:"教学改革项目成果",materialType:"document",fileUrl:"/files/teaching-reform.pdf",description:"教学方法创新项目的实施记录和成果",uploadTime:"2024-03-06 14:20:00",status:"approved",approveTime:"2024-03-07 09:15:00",approver:"管理员",rejectReason:""},{id:3,taskId:1,taskName:"2024年度教师自评",indicatorId:2,indicatorName:"课堂管理",teacherId:"T002",teacherName:"李老师",materialName:"课堂管理记录",materialType:"document",fileUrl:"/files/class-management.pdf",description:"本学期课堂管理情况记录",uploadTime:"2024-03-04 16:45:00",status:"rejected",approveTime:"2024-03-05 11:20:00",approver:"管理员",rejectReason:"材料不完整，缺少学生反馈记录"},{id:4,taskId:1,taskName:"2024年度教师自评",indicatorId:8,indicatorName:"学生评价",teacherId:"T003",teacherName:"王老师",materialName:"学生评教汇总报告",materialType:"document",fileUrl:"/files/student-eval.pdf",description:"2024年春季学期学生评教结果汇总",uploadTime:"2024-03-07 09:15:00",status:"pending",approveTime:null,approver:null,rejectReason:""},{id:5,taskId:1,taskName:"2024年度教师自评",indicatorId:11,indicatorName:"学术研究",teacherId:"T003",teacherName:"王老师",materialName:"科研项目结题证书",materialType:"document",fileUrl:"/files/research-cert.pdf",description:"2023年度省级科研项目结题材料",uploadTime:"2024-03-08 15:30:00",status:"pending",approveTime:null,approver:null,rejectReason:""}],I=M(()=>p.value.filter(o=>o.status==="pending")),j=M(()=>p.value.filter(o=>o.status==="approved"||o.status==="rejected")),y=()=>{const o=localStorage.getItem("evaluationMaterials");if(o)try{const r=JSON.parse(o);p.value=r&&r.length>0?r:[...v]}catch{p.value=[...v]}else p.value=[...v];t()},t=()=>{localStorage.setItem("evaluationMaterials",JSON.stringify(p.value))},g=o=>p.value.filter(r=>r.teacherId===o),b=o=>p.value.find(r=>r.id===o),T=(o,r)=>{const m=b(o);return m?(m.status="approved",m.approveTime=new Date().toLocaleString("zh-CN"),m.approver=r,m.rejectReason="",t(),!0):!1},R=(o,r,m)=>{const i=b(o);return i?(i.status="rejected",i.approveTime=new Date().toLocaleString("zh-CN"),i.approver=r,i.rejectReason=m,t(),!0):!1},S=o=>{const r={id:Date.now(),...o,uploadTime:new Date().toLocaleString("zh-CN"),status:"pending",approveTime:null,approver:null,rejectReason:""};return p.value.push(r),t(),r},U=o=>{const r=p.value.findIndex(m=>m.id===o);return r!==-1?(p.value.splice(r,1),t(),!0):!1},z=()=>{p.value=[...v],t()};return y(),{materials:p,pendingMaterials:I,processedMaterials:j,getMaterialsByTeacher:g,getMaterialById:b,approveMaterial:T,rejectMaterial:R,uploadMaterial:S,deleteMaterial:U,saveMaterials:t,resetMaterials:z}}),Y={class:"material-approval"},Z={class:"header"},ee={class:"stats"},ae={style:{color:"#f56c6c"}},te={__name:"MaterialApproval",setup(p){const v=X(),I=w("pending"),j=w(!1),y=w(!1),t=w(null),g=w({reason:""}),b=M(()=>v.pendingMaterials),T=M(()=>v.processedMaterials),R=M(()=>b.value.length),S=M(()=>T.value.length);K(()=>{console.log("=== MaterialApproval Debug ==="),console.log("Store materials length:",v.materials.length),console.log("Pending materials:",b.value.length),console.log("Processed materials:",T.value.length),v.materials.length===0&&localStorage.getItem("evaluationMaterials")&&(console.log("Found data in localStorage but store is empty, reloading..."),v.resetMaterials())});const U=i=>{L.confirm(`确定通过「${i.teacherName}」的材料吗？`,"确认通过",{type:"success"}).then(()=>{approveMaterial(i.id,"管理员"),B.success("已通过")}).catch(()=>{})},z=i=>{t.value=i,g.value.reason="",y.value=!0},o=()=>{if(!g.value.reason.trim()){B.warning("请输入驳回原因");return}rejectMaterial(t.value.id,"管理员",g.value.reason),y.value=!1,B.success("已驳回")},r=i=>{t.value=i,j.value=!0},m=i=>{L.alert(i.rejectReason,"驳回原因",{confirmButtonText:"知道了"})};return(i,l)=>{const C=u("el-tag"),d=u("el-table-column"),k=u("el-button"),D=u("el-table"),$=u("el-empty"),A=u("el-tab-pane"),O=u("el-tabs"),q=u("el-card"),f=u("el-descriptions-item"),F=u("el-descriptions"),E=u("el-dialog"),J=u("el-input"),P=u("el-form-item"),G=u("el-form");return _(),Q("div",Y,[e(q,{shadow:"hover"},{header:a(()=>[x("div",Z,[l[5]||(l[5]=x("span",{class:"title"},"评价材料审批",-1)),x("div",ee,[e(C,{type:"warning"},{default:a(()=>[n("待审批: "+c(R.value),1)]),_:1}),e(C,{type:"info"},{default:a(()=>[n("已处理: "+c(S.value),1)]),_:1})])])]),default:a(()=>[e(O,{modelValue:I.value,"onUpdate:modelValue":l[0]||(l[0]=s=>I.value=s)},{default:a(()=>[e(A,{label:"待办审批",name:"pending"},{default:a(()=>[e(D,{data:b.value,border:"",stripe:""},{default:a(()=>[e(d,{prop:"taskName",label:"任务名称",width:"180"}),e(d,{prop:"indicatorName",label:"评价指标",width:"120"}),e(d,{prop:"teacherName",label:"教师",width:"100"}),e(d,{prop:"materialName",label:"材料名称",width:"180","show-overflow-tooltip":""}),e(d,{prop:"description",label:"说明","min-width":"200","show-overflow-tooltip":""}),e(d,{prop:"uploadTime",label:"上传时间",width:"160"}),e(d,{label:"操作",width:"240",fixed:"right"},{default:a(({row:s})=>[e(k,{type:"success",size:"small",onClick:V=>U(s)},{default:a(()=>[...l[6]||(l[6]=[n("通过",-1)])]),_:1},8,["onClick"]),e(k,{type:"danger",size:"small",onClick:V=>z(s)},{default:a(()=>[...l[7]||(l[7]=[n("驳回",-1)])]),_:1},8,["onClick"]),e(k,{type:"primary",size:"small",onClick:V=>r(s)},{default:a(()=>[...l[8]||(l[8]=[n("查看",-1)])]),_:1},8,["onClick"])]),_:1})]),_:1},8,["data"]),b.value.length===0?(_(),h($,{key:0,description:"暂无待审批材料"})):N("",!0)]),_:1}),e(A,{label:"已办审批",name:"processed"},{default:a(()=>[e(D,{data:T.value,border:"",stripe:""},{default:a(()=>[e(d,{prop:"taskName",label:"任务名称",width:"180"}),e(d,{prop:"indicatorName",label:"评价指标",width:"120"}),e(d,{prop:"teacherName",label:"教师",width:"100"}),e(d,{prop:"materialName",label:"材料名称",width:"180","show-overflow-tooltip":""}),e(d,{label:"状态",width:"100"},{default:a(({row:s})=>[e(C,{type:s.status==="approved"?"success":"danger"},{default:a(()=>[n(c(s.status==="approved"?"已通过":"已驳回"),1)]),_:2},1032,["type"])]),_:1}),e(d,{prop:"approver",label:"审批人",width:"100"}),e(d,{prop:"approveTime",label:"审批时间",width:"160"}),e(d,{label:"操作",width:"150",fixed:"right"},{default:a(({row:s})=>[e(k,{type:"primary",size:"small",onClick:V=>r(s)},{default:a(()=>[...l[9]||(l[9]=[n("查看",-1)])]),_:1},8,["onClick"]),s.status==="rejected"?(_(),h(k,{key:0,type:"info",size:"small",onClick:V=>m(s)},{default:a(()=>[...l[10]||(l[10]=[n("原因",-1)])]),_:1},8,["onClick"])):N("",!0)]),_:1})]),_:1},8,["data"]),T.value.length===0?(_(),h($,{key:0,description:"暂无已处理材料"})):N("",!0)]),_:1})]),_:1},8,["modelValue"])]),_:1}),e(E,{modelValue:j.value,"onUpdate:modelValue":l[1]||(l[1]=s=>j.value=s),title:"材料详情",width:"600px"},{default:a(()=>[t.value?(_(),h(F,{key:0,column:2,border:""},{default:a(()=>[e(f,{label:"任务名称"},{default:a(()=>[n(c(t.value.taskName),1)]),_:1}),e(f,{label:"评价指标"},{default:a(()=>[n(c(t.value.indicatorName),1)]),_:1}),e(f,{label:"教师姓名"},{default:a(()=>[n(c(t.value.teacherName),1)]),_:1}),e(f,{label:"材料名称"},{default:a(()=>[n(c(t.value.materialName),1)]),_:1}),e(f,{label:"材料说明",span:2},{default:a(()=>[n(c(t.value.description),1)]),_:1}),e(f,{label:"上传时间",span:2},{default:a(()=>[n(c(t.value.uploadTime),1)]),_:1}),t.value.status!=="pending"?(_(),h(f,{key:0,label:"审批状态",span:2},{default:a(()=>[e(C,{type:t.value.status==="approved"?"success":"danger"},{default:a(()=>[n(c(t.value.status==="approved"?"已通过":"已驳回"),1)]),_:1},8,["type"])]),_:1})):N("",!0),t.value.approver?(_(),h(f,{key:1,label:"审批人"},{default:a(()=>[n(c(t.value.approver),1)]),_:1})):N("",!0),t.value.approveTime?(_(),h(f,{key:2,label:"审批时间"},{default:a(()=>[n(c(t.value.approveTime),1)]),_:1})):N("",!0),t.value.rejectReason?(_(),h(f,{key:3,label:"驳回原因",span:2},{default:a(()=>[x("span",ae,c(t.value.rejectReason),1)]),_:1})):N("",!0)]),_:1})):N("",!0)]),_:1},8,["modelValue"]),e(E,{modelValue:y.value,"onUpdate:modelValue":l[4]||(l[4]=s=>y.value=s),title:"驳回材料",width:"500px"},{footer:a(()=>[e(k,{onClick:l[3]||(l[3]=s=>y.value=!1)},{default:a(()=>[...l[11]||(l[11]=[n("取消",-1)])]),_:1}),e(k,{type:"danger",onClick:o},{default:a(()=>[...l[12]||(l[12]=[n("确认驳回",-1)])]),_:1})]),default:a(()=>[e(G,{model:g.value,"label-width":"100px"},{default:a(()=>[e(P,{label:"驳回原因",required:""},{default:a(()=>[e(J,{modelValue:g.value.reason,"onUpdate:modelValue":l[2]||(l[2]=s=>g.value.reason=s),type:"textarea",rows:4,placeholder:"请输入驳回原因"},null,8,["modelValue"])]),_:1})]),_:1},8,["model"])]),_:1},8,["modelValue"])])}}},re=W(te,[["__scopeId","data-v-36ab96b4"]]);export{re as default};
