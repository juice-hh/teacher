import{o as u,c as _,b as t,w as a,a as n,j as b,r,y as z,D as v,f,K as J,h as d,F as h,p as B,R as ve,C as _e,q as k,M as fe,H as P,I as Q,N as W,O as x,S as X}from"./index-BQs85f6M.js";import{u as ge}from"./rules-uKwgUioL.js";import{_ as ye}from"./_plugin-vue_export-helper-DlAUqK2U.js";const be={class:"rule-management"},ke={class:"header-content"},Ve={class:"layout-container"},we={class:"list-header"},Ce={class:"rules-list"},Re=["onClick"],xe={class:"rule-item-header"},Ie={class:"rule-info"},Fe={class:"rule-name"},he={class:"rule-desc"},Be={class:"rule-meta"},Me={class:"rule-date"},Te={key:0,class:"rule-detail-card"},Se={class:"detail-header"},$e={class:"detail-info"},ze={class:"detail-title"},Ue={class:"detail-desc"},De={class:"detail-actions"},qe={class:"scoring-items"},Ne={class:"items-header"},Ee={__name:"RuleManagement",setup(je){const m=ge(),g=v("attendance"),y=v(null),p=z(()=>y.value?m.getRuleById(y.value):null),V=v(!1),w=v(!1),I=v(null),C=v(null),F=v(null),q=m.ruleTypes,N=z(()=>m.getRulesByType(g.value)),Y=o=>({attendance:"Clock",open_class:"VideoCamera",training:"Reading",basic_skills:"Trophy",paper:"Document",academic_work:"Collection"})[o]||"Document",Z=o=>{y.value=o.id},U=v(null),D=v(null),i=X({name:"",type:"paper",description:""}),ee={name:[{required:!0,message:"请输入规则名称",trigger:"blur"}],type:[{required:!0,message:"请选择规则类型",trigger:"change"}],description:[{required:!0,message:"请输入规则描述",trigger:"blur"}]},s=X({indicator:"",level:"",score:0}),le={indicator:[{required:!0,message:"请选择或输入指标",trigger:"change"}],level:[{required:!1,message:"请选择或输入等级",trigger:"change"}],score:[{required:!0,message:"请输入分值",trigger:"blur"}]},te=z(()=>({attendance:["迟到","早退","缺勤"],open_class:["级部","学科组","教研组","校级"],training:["校级","市级","省级","国家级"],basic_skills:["国家级","省级","地市级","县市区","校级"],paper:["国家级","省级","地市级","县市区","校级"],academic_work:["单独作者","多作者"]})[g.value]||[]),ae=z(()=>({attendance:[],open_class:[],training:[],basic_skills:["一等奖","二等奖","三等奖","优秀奖"],paper:["一等奖","二等奖","三等奖","优秀奖"],academic_work:["一作","二作","三作","其他"]})[g.value]||[]),oe=o=>{I.value=o,i.name=o.name,i.type=o.type,i.description=o.description,V.value=!0},ne=o=>{W.confirm(`确定要删除规则"${o.name}"吗？此操作不可恢复。`,"确认删除",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then(()=>{m.deleteRule(o.id),y.value===o.id&&(y.value=null),x.success("删除成功")}).catch(()=>{})},se=()=>{U.value.validate(o=>{if(o){if(I.value)m.updateRule(I.value.id,i),x.success("更新成功");else{const e=m.addRule(i);y.value=e.id,x.success("创建成功")}V.value=!1,E()}})},E=()=>{var o;I.value=null,i.name="",i.type=g.value,i.description="",(o=U.value)==null||o.clearValidate()},ie=o=>{F.value=o.id,C.value=null,s.indicator="",s.level="",s.score=0,w.value=!0},ue=(o,e)=>{F.value=o.id,C.value=e,s.indicator=e.indicator,s.level=e.level,s.score=e.score,w.value=!0},re=(o,e)=>{W.confirm("确定要删除该评分项吗？","确认删除",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then(()=>{m.deleteScoringItem(o.id,e),x.success("删除成功")}).catch(()=>{})},de=()=>{D.value.validate(o=>{o&&(C.value?(m.updateScoringItem(F.value,C.value.id,s),x.success("更新成功")):(m.addScoringItem(F.value,s),x.success("添加成功")),w.value=!1,j())})},j=()=>{var o;C.value=null,F.value=null,s.indicator="",s.level="",s.score=0,(o=D.value)==null||o.clearValidate()};return(o,e)=>{const c=r("el-button"),M=r("el-card"),T=r("el-option"),S=r("el-select"),ce=r("el-icon"),A=r("el-tag"),H=r("el-empty"),$=r("el-table-column"),me=r("el-table"),K=r("el-input"),R=r("el-form-item"),L=r("el-form"),O=r("el-dialog"),pe=r("el-input-number");return u(),_("div",be,[t(M,{class:"header-card"},{default:a(()=>[n("div",ke,[e[16]||(e[16]=n("div",null,[n("h2",{class:"page-title"},"评价规则管理"),n("p",{class:"page-desc"},"配置各类评价指标的评分规则，支持论文、课题、比赛等类型的赋分细则")],-1)),t(c,{type:"primary",icon:f(J),onClick:e[0]||(e[0]=l=>V.value=!0)},{default:a(()=>[...e[15]||(e[15]=[d(" 新建评价规则 ",-1)])]),_:1},8,["icon"])])]),_:1}),n("div",Ve,[t(M,{class:"rules-list-card"},{header:a(()=>[n("div",we,[e[17]||(e[17]=n("span",null,"规则列表",-1)),t(S,{modelValue:g.value,"onUpdate:modelValue":e[1]||(e[1]=l=>g.value=l),size:"small",style:{width:"140px"}},{default:a(()=>[(u(!0),_(h,null,B(f(q),l=>(u(),b(T,{key:l.value,value:l.value,label:l.label},null,8,["value","label"]))),128))]),_:1},8,["modelValue"])])]),default:a(()=>[n("div",Ce,[(u(!0),_(h,null,B(N.value,l=>(u(),_("div",{key:l.id,class:ve(["rule-item",{active:y.value===l.id}]),onClick:G=>Z(l)},[n("div",xe,[t(ce,{size:18,class:"rule-icon"},{default:a(()=>[(u(),b(_e(Y(g.value))))]),_:1}),n("div",Ie,[n("h4",Fe,k(l.name),1),n("p",he,k(l.description),1)])]),n("div",Be,[t(A,{size:"small",type:"info"},{default:a(()=>[d(k(l.scoringItems.length)+" 项细则",1)]),_:2},1024),n("span",Me,k(l.createdAt),1)])],10,Re))),128)),N.value.length===0?(u(),b(H,{key:0,description:"暂无该类型的评价规则","image-size":100})):fe("",!0)])]),_:1}),p.value?(u(),_("div",Te,[t(M,null,{header:a(()=>[n("div",Se,[n("div",$e,[n("h3",ze,k(p.value.name),1),n("p",Ue,k(p.value.description),1)]),n("div",De,[t(c,{type:"primary",icon:f(P),onClick:e[2]||(e[2]=l=>oe(p.value))},{default:a(()=>[...e[18]||(e[18]=[d(" 编辑规则 ",-1)])]),_:1},8,["icon"]),t(c,{type:"danger",icon:f(Q),onClick:e[3]||(e[3]=l=>ne(p.value))},{default:a(()=>[...e[19]||(e[19]=[d(" 删除规则 ",-1)])]),_:1},8,["icon"])])])]),default:a(()=>[n("div",qe,[n("div",Ne,[e[21]||(e[21]=n("h4",null,"评分细则",-1)),t(c,{type:"primary",icon:f(J),size:"small",onClick:e[4]||(e[4]=l=>ie(p.value))},{default:a(()=>[...e[20]||(e[20]=[d(" 添加评分项 ",-1)])]),_:1},8,["icon"])]),t(me,{data:p.value.scoringItems,border:"",style:{width:"100%"}},{default:a(()=>[t($,{prop:"indicator",label:"指标","min-width":"150"}),t($,{prop:"level",label:"等级",width:"150"}),t($,{prop:"score",label:"分值",width:"100"},{default:a(({row:l})=>[t(A,{type:"success"},{default:a(()=>[d(k(l.score)+" 分",1)]),_:2},1024)]),_:1}),t($,{label:"操作",width:"150",align:"center",fixed:"right"},{default:a(({row:l})=>[t(c,{type:"primary",size:"small",link:"",icon:f(P),onClick:G=>ue(p.value,l)},{default:a(()=>[...e[22]||(e[22]=[d(" 编辑 ",-1)])]),_:1},8,["icon","onClick"]),t(c,{type:"danger",size:"small",link:"",icon:f(Q),onClick:G=>re(p.value,l.id)},{default:a(()=>[...e[23]||(e[23]=[d(" 删除 ",-1)])]),_:1},8,["icon","onClick"])]),_:1})]),_:1},8,["data"])])]),_:1})])):(u(),b(M,{key:1,class:"rule-detail-card"},{default:a(()=>[t(H,{description:"请从左侧选择一个规则查看详情","image-size":120})]),_:1}))]),t(O,{modelValue:V.value,"onUpdate:modelValue":e[9]||(e[9]=l=>V.value=l),title:I.value?"编辑评价规则":"新建评价规则",width:"600px",onClose:E},{footer:a(()=>[t(c,{onClick:e[8]||(e[8]=l=>V.value=!1)},{default:a(()=>[...e[24]||(e[24]=[d("取消",-1)])]),_:1}),t(c,{type:"primary",onClick:se},{default:a(()=>[...e[25]||(e[25]=[d("确定",-1)])]),_:1})]),default:a(()=>[t(L,{model:i,rules:ee,ref_key:"ruleFormRef",ref:U,"label-width":"100px"},{default:a(()=>[t(R,{label:"规则名称",prop:"name"},{default:a(()=>[t(K,{modelValue:i.name,"onUpdate:modelValue":e[5]||(e[5]=l=>i.name=l),placeholder:"请输入规则名称"},null,8,["modelValue"])]),_:1}),t(R,{label:"规则类型",prop:"type"},{default:a(()=>[t(S,{modelValue:i.type,"onUpdate:modelValue":e[6]||(e[6]=l=>i.type=l),placeholder:"请选择或输入新增规则类型",filterable:"","allow-create":"",style:{width:"100%"}},{default:a(()=>[(u(!0),_(h,null,B(f(q),l=>(u(),b(T,{key:l.value,label:l.label,value:l.value},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])]),_:1}),t(R,{label:"规则描述",prop:"description"},{default:a(()=>[t(K,{modelValue:i.description,"onUpdate:modelValue":e[7]||(e[7]=l=>i.description=l),type:"textarea",rows:3,placeholder:"请输入规则描述"},null,8,["modelValue"])]),_:1})]),_:1},8,["model"])]),_:1},8,["modelValue","title"]),t(O,{modelValue:w.value,"onUpdate:modelValue":e[14]||(e[14]=l=>w.value=l),title:C.value?"编辑评分项":"添加评分项",width:"500px",onClose:j},{footer:a(()=>[t(c,{onClick:e[13]||(e[13]=l=>w.value=!1)},{default:a(()=>[...e[26]||(e[26]=[d("取消",-1)])]),_:1}),t(c,{type:"primary",onClick:de},{default:a(()=>[...e[27]||(e[27]=[d("确定",-1)])]),_:1})]),default:a(()=>[t(L,{model:s,rules:le,ref_key:"itemFormRef",ref:D,"label-width":"120px"},{default:a(()=>[t(R,{label:"指标",prop:"indicator"},{default:a(()=>[t(S,{modelValue:s.indicator,"onUpdate:modelValue":e[10]||(e[10]=l=>s.indicator=l),placeholder:"请选择",filterable:"","allow-create":"",style:{width:"100%"}},{default:a(()=>[(u(!0),_(h,null,B(te.value,l=>(u(),b(T,{key:l,label:l,value:l},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])]),_:1}),t(R,{label:"等级",prop:"level"},{default:a(()=>[t(S,{modelValue:s.level,"onUpdate:modelValue":e[11]||(e[11]=l=>s.level=l),placeholder:"请选择级别",filterable:"","allow-create":"",style:{width:"100%"}},{default:a(()=>[(u(!0),_(h,null,B(ae.value,l=>(u(),b(T,{key:l,label:l,value:l},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])]),_:1}),t(R,{label:"分值",prop:"score"},{default:a(()=>[t(pe,{modelValue:s.score,"onUpdate:modelValue":e[12]||(e[12]=l=>s.score=l),min:0,max:200},null,8,["modelValue"])]),_:1})]),_:1},8,["model"])]),_:1},8,["modelValue","title"])])}}},Le=ye(Ee,[["__scopeId","data-v-1acfae01"]]);export{Le as default};
