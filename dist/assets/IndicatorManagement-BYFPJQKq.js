import{E as pe,o as p,c as k,b as l,w as t,r as s,D as V,e as ce,F as S,p as z,f as u,j as C,a as c,h as i,q as _,G as A,H as j,I as G,J as fe,K as H,L as ve,M as _e,N as J,O as b}from"./index-BQs85f6M.js";import{u as ye}from"./indicator-ax52G24x.js";import{u as be}from"./rules-uKwgUioL.js";import{_ as ke}from"./_plugin-vue_export-helper-DlAUqK2U.js";const Ve={class:"indicator-management"},ge={class:"card-header"},we={class:"header-actions"},Re={class:"primary-title"},Ie={class:"primary-name"},xe={class:"primary-desc"},Ce={class:"secondary-list"},Be={key:1,class:"text-placeholder"},Se={class:"rule-option-desc"},ze={class:"form-tip"},Ue={key:0,class:"linked-rule-details",style:{"margin-top":"12px",width:"100%"}},$e={__name:"IndicatorManagement",setup(Pe){const U=ce(),y=ye(),$=be(),{primaryIndicators:P,secondaryIndicators:Ee,getSecondaryByPrimary:E}=y,{ruleTypes:K,getRulesByType:O,getRuleById:Q}=$,M=V([1,2,3,4,5]),g=V(!1),w=V(!1),B=V(!1),I=V(!1),W=n=>{if(!n)return[];const e=Q(n);return e?e.scoringItems:[]},r=V({id:null,name:"",score:20,description:""}),o=V({id:null,primaryId:null,name:"",score:5,scoringRule:"",linkedRuleId:null,linkedRule:"",materialRequirement:"",responsibleBody:""});pe(()=>{y.loadFromLocal()});function X(){B.value=!1,r.value={id:null,name:"",score:20,description:""},g.value=!0}function Y(n){B.value=!0,r.value={...n},g.value=!0}function Z(){if(!r.value.name){b.warning("请输入指标名称");return}B.value?(y.updatePrimaryIndicator(r.value.id,r.value),b.success("更新成功")):(y.addPrimaryIndicator(r.value),b.success("添加成功")),g.value=!1}function ee(n){J.confirm("删除该指标将同时删除其下所有二级指标，确定要删除吗？","提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then(()=>{y.deletePrimaryIndicator(n),b.success("删除成功")})}function le(n){I.value=!1,o.value={id:null,primaryId:n,name:"",score:5,scoringRule:"",linkedRuleId:null,linkedRule:"",materialRequirement:"",responsibleBody:""},w.value=!0}function ae(n){I.value=!0,o.value={...n},w.value=!0}function te(){if(!o.value.name){b.warning("请输入指标名称");return}if(o.value.linkedRuleId){const n=$.getRuleById(o.value.linkedRuleId);n&&(o.value.linkedRule=n.name)}else o.value.linkedRule="";I.value?(y.updateSecondaryIndicator(o.value.id,o.value),b.success("更新成功")):(y.addSecondaryIndicator(o.value),b.success("添加成功")),w.value=!1}function oe(n){J.confirm("确定要删除该二级指标吗？","提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then(()=>{y.deleteSecondaryIndicator(n),b.success("删除成功")})}function ne(n){U.push(`/admin/indicator-detail/primary/${n}`)}function de(n){U.push(`/admin/indicator-detail/secondary/${n}`)}return(n,e)=>{const m=s("el-button"),x=s("el-tag"),f=s("el-table-column"),T=s("el-table"),ie=s("el-collapse-item"),se=s("el-collapse"),ue=s("el-card"),R=s("el-input"),v=s("el-form-item"),q=s("el-input-number"),D=s("el-form"),N=s("el-dialog"),F=s("el-option"),L=s("el-select"),re=s("el-option-group"),me=s("el-icon");return p(),k("div",Ve,[l(ue,{class:"page-card",shadow:"hover"},{header:t(()=>[c("div",ge,[e[17]||(e[17]=c("span",{class:"card-title"},"评价指标管理",-1)),c("div",we,[l(m,{type:"primary",icon:u(H),onClick:X},{default:t(()=>[...e[16]||(e[16]=[i(" 新增一级指标 ",-1)])]),_:1},8,["icon"])])])]),default:t(()=>[l(se,{modelValue:M.value,"onUpdate:modelValue":e[1]||(e[1]=a=>M.value=a),class:"indicator-collapse"},{default:t(()=>[(p(!0),k(S,null,z(u(P),a=>(p(),C(ie,{key:a.id,name:a.id},{title:t(()=>[c("div",Re,[c("span",Ie,_(a.name),1),l(x,{type:"primary",size:"large"},{default:t(()=>[i(_(a.score)+"分",1)]),_:2},1024),l(x,{type:"info",size:"small"},{default:t(()=>[i("共 "+_(u(E)(a.id).length)+" 项二级指标",1)]),_:2},1024),c("span",xe,_(a.description),1),c("div",{class:"title-actions",onClick:e[0]||(e[0]=fe(()=>{},["stop"]))},[l(m,{type:"primary",size:"small",icon:u(H),onClick:d=>le(a.id)},{default:t(()=>[...e[18]||(e[18]=[i(" 新增二级指标 ",-1)])]),_:1},8,["icon","onClick"]),l(m,{type:"success",size:"small",icon:u(A),onClick:d=>ne(a.id)},{default:t(()=>[...e[19]||(e[19]=[i(" 查看 ",-1)])]),_:1},8,["icon","onClick"]),l(m,{size:"small",icon:u(j),onClick:d=>Y(a)},{default:t(()=>[...e[20]||(e[20]=[i(" 编辑 ",-1)])]),_:1},8,["icon","onClick"]),l(m,{type:"danger",size:"small",icon:u(G),onClick:d=>ee(a.id)},{default:t(()=>[...e[21]||(e[21]=[i(" 删除 ",-1)])]),_:1},8,["icon","onClick"])])])]),default:t(()=>[c("div",Ce,[l(T,{data:u(E)(a.id),style:{width:"100%"}},{default:t(()=>[l(f,{prop:"name",label:"二级指标名称",width:"150"}),l(f,{prop:"score",label:"分值",width:"80"},{default:t(({row:d})=>[l(x,{type:"warning"},{default:t(()=>[i(_(d.score)+"分",1)]),_:2},1024)]),_:1}),l(f,{prop:"scoringRule",label:"评分标准","show-overflow-tooltip":""}),l(f,{prop:"linkedRule",label:"关联评价规则",width:"150","show-overflow-tooltip":""},{default:t(({row:d})=>[d.linkedRule?(p(),C(x,{key:0,type:"info",size:"small"},{default:t(()=>[i(_(d.linkedRule),1)]),_:2},1024)):(p(),k("span",Be,"未关联"))]),_:1}),l(f,{prop:"materialRequirement",label:"材料要求",width:"180","show-overflow-tooltip":""}),l(f,{prop:"responsibleBody",label:"责任部门",width:"120"}),l(f,{label:"操作",width:"240",fixed:"right"},{default:t(({row:d})=>[l(m,{type:"success",size:"small",icon:u(A),onClick:h=>de(d.id)},{default:t(()=>[...e[22]||(e[22]=[i(" 查看 ",-1)])]),_:1},8,["icon","onClick"]),l(m,{type:"primary",size:"small",icon:u(j),onClick:h=>ae(d)},{default:t(()=>[...e[23]||(e[23]=[i(" 编辑 ",-1)])]),_:1},8,["icon","onClick"]),l(m,{type:"danger",size:"small",icon:u(G),onClick:h=>oe(d.id)},{default:t(()=>[...e[24]||(e[24]=[i(" 删除 ",-1)])]),_:1},8,["icon","onClick"])]),_:1})]),_:1},8,["data"])])]),_:2},1032,["name"]))),128))]),_:1},8,["modelValue"])]),_:1}),l(N,{modelValue:g.value,"onUpdate:modelValue":e[6]||(e[6]=a=>g.value=a),title:B.value?"编辑一级指标":"新增一级指标",width:"500px"},{footer:t(()=>[l(m,{onClick:e[5]||(e[5]=a=>g.value=!1)},{default:t(()=>[...e[25]||(e[25]=[i("取消",-1)])]),_:1}),l(m,{type:"primary",onClick:Z},{default:t(()=>[...e[26]||(e[26]=[i("确定",-1)])]),_:1})]),default:t(()=>[l(D,{model:r.value,"label-width":"100px"},{default:t(()=>[l(v,{label:"指标名称"},{default:t(()=>[l(R,{modelValue:r.value.name,"onUpdate:modelValue":e[2]||(e[2]=a=>r.value.name=a),placeholder:"请输入指标名称"},null,8,["modelValue"])]),_:1}),l(v,{label:"分值"},{default:t(()=>[l(q,{modelValue:r.value.score,"onUpdate:modelValue":e[3]||(e[3]=a=>r.value.score=a),min:1,max:100},null,8,["modelValue"])]),_:1}),l(v,{label:"描述"},{default:t(()=>[l(R,{modelValue:r.value.description,"onUpdate:modelValue":e[4]||(e[4]=a=>r.value.description=a),type:"textarea",rows:3,placeholder:"请输入指标描述"},null,8,["modelValue"])]),_:1})]),_:1},8,["model"])]),_:1},8,["modelValue","title"]),l(N,{modelValue:w.value,"onUpdate:modelValue":e[15]||(e[15]=a=>w.value=a),title:I.value?"编辑二级指标":"新增二级指标",width:"600px"},{footer:t(()=>[l(m,{onClick:e[14]||(e[14]=a=>w.value=!1)},{default:t(()=>[...e[29]||(e[29]=[i("取消",-1)])]),_:1}),l(m,{type:"primary",onClick:te},{default:t(()=>[...e[30]||(e[30]=[i("确定",-1)])]),_:1})]),default:t(()=>[l(D,{model:o.value,"label-width":"100px"},{default:t(()=>[l(v,{label:"所属一级指标"},{default:t(()=>[l(L,{modelValue:o.value.primaryId,"onUpdate:modelValue":e[7]||(e[7]=a=>o.value.primaryId=a),placeholder:"请选择",disabled:I.value},{default:t(()=>[(p(!0),k(S,null,z(u(P),a=>(p(),C(F,{key:a.id,label:a.name,value:a.id},null,8,["label","value"]))),128))]),_:1},8,["modelValue","disabled"])]),_:1}),l(v,{label:"指标名称"},{default:t(()=>[l(R,{modelValue:o.value.name,"onUpdate:modelValue":e[8]||(e[8]=a=>o.value.name=a),placeholder:"请输入指标名称"},null,8,["modelValue"])]),_:1}),l(v,{label:"分值"},{default:t(()=>[l(q,{modelValue:o.value.score,"onUpdate:modelValue":e[9]||(e[9]=a=>o.value.score=a),min:1,max:50},null,8,["modelValue"])]),_:1}),l(v,{label:"评分标准"},{default:t(()=>[l(R,{modelValue:o.value.scoringRule,"onUpdate:modelValue":e[10]||(e[10]=a=>o.value.scoringRule=a),type:"textarea",rows:3,placeholder:"请输入评分标准"},null,8,["modelValue"])]),_:1}),l(v,{label:"关联评价规则"},{default:t(()=>[l(L,{modelValue:o.value.linkedRuleId,"onUpdate:modelValue":e[11]||(e[11]=a=>o.value.linkedRuleId=a),placeholder:"请选择关联的评价规则（可选）",clearable:"",style:{width:"100%"}},{default:t(()=>[(p(!0),k(S,null,z(u(K),a=>(p(),C(re,{key:a.value,label:a.label},{default:t(()=>[(p(!0),k(S,null,z(u(O)(a.value),d=>(p(),C(F,{key:d.id,label:d.name,value:d.id},{default:t(()=>[c("span",null,_(d.name),1),c("span",Se,"（"+_(d.scoringItems.length)+" 项细则）",1)]),_:2},1032,["label","value"]))),128))]),_:2},1032,["label"]))),128))]),_:1},8,["modelValue"]),c("div",ze,[l(me,null,{default:t(()=>[l(u(ve))]),_:1}),e[27]||(e[27]=i(" 选择后，该指标将按照所选规则的评分细则进行计算 ",-1))]),o.value.linkedRuleId?(p(),k("div",Ue,[e[28]||(e[28]=c("div",{class:"linked-rule-title",style:{"font-size":"13px","font-weight":"500","margin-bottom":"8px",color:"#595959"}},"主要评分细则预览",-1)),l(T,{data:W(o.value.linkedRuleId),border:"",size:"small"},{default:t(()=>[l(f,{prop:"indicator",label:"细则指标","min-width":"120"}),l(f,{prop:"level",label:"指标等级",width:"100"}),l(f,{prop:"score",label:"对应分值",width:"80"},{default:t(({row:a})=>[l(x,{size:"small",type:"success"},{default:t(()=>[i(_(a.score)+"分",1)]),_:2},1024)]),_:1})]),_:1},8,["data"])])):_e("",!0)]),_:1}),l(v,{label:"材料要求"},{default:t(()=>[l(R,{modelValue:o.value.materialRequirement,"onUpdate:modelValue":e[12]||(e[12]=a=>o.value.materialRequirement=a),type:"textarea",rows:2,placeholder:"请输入材料要求"},null,8,["modelValue"])]),_:1}),l(v,{label:"责任部门"},{default:t(()=>[l(R,{modelValue:o.value.responsibleBody,"onUpdate:modelValue":e[13]||(e[13]=a=>o.value.responsibleBody=a),placeholder:"请输入责任部门"},null,8,["modelValue"])]),_:1})]),_:1},8,["model"])]),_:1},8,["modelValue","title"])])}}},Ne=ke($e,[["__scopeId","data-v-2864c731"]]);export{Ne as default};
